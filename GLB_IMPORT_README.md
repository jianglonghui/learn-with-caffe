# GLB文件导入功能说明

## 功能概述

本项目新增了GLB文件导入功能，允许用户上传3D模型文件（.glb格式），系统会自动将模型转换为体素（方块）形式，并添加到背包中供用户在3D场景中使用。

## 功能特点

### 🎯 核心功能
- **GLB文件加载**: 支持加载标准的GLB/GLTF文件
- **自动体素化**: 将3D模型转换为体素网格
- **智能处理**: 自动检测模型边界并生成合适的体素
- **颜色保留**: 尽可能保留原始模型的颜色信息
- **背包集成**: 生成的体素物品自动添加到背包

### 🔧 技术实现
- 使用Three.js的GLTFLoader加载GLB文件
- 通过光线投射算法进行体素化
- 支持Draco压缩格式
- 自动居中处理

## 使用方法

### 1. 访问功能
1. 打开应用，进入3D世界编辑器
2. 在绘图模式下，找到"📦 导入GLB"按钮
3. 点击按钮选择GLB文件

### 2. 文件要求
- **格式**: 仅支持.glb文件
- **大小**: 建议文件大小不超过10MB
- **复杂度**: 建议模型面数不超过10,000面以获得最佳性能

### 3. 处理过程
1. 选择文件后，系统会显示"处理中..."状态
2. 系统自动加载GLB文件并提取第一个网格
3. 使用体素化算法将模型转换为方块
4. 处理完成后，物品自动添加到背包
5. 显示成功消息，包含生成的体素数量

### 4. 使用生成的物品
- 生成的物品会出现在背包中
- 点击背包中的物品可以放置到3D场景
- 支持调整物品的缩放、质量和弹性
- 可以像其他物品一样进行物理交互

## 技术细节

### 体素化算法
```javascript
// 核心算法流程
1. 计算模型的边界框
2. 根据分辨率确定体素大小
3. 在边界框内采样点
4. 使用光线投射判断点是否在模型内部
5. 生成体素数据并居中处理
```

### 参数配置
- **分辨率**: 默认25，控制体素的精细程度
- **颜色处理**: 自动提取材质颜色
- **边界处理**: 自动计算并居中体素

## 错误处理

### 常见错误
1. **文件格式错误**: 确保选择的是.glb文件
2. **文件损坏**: 尝试使用其他GLB文件
3. **模型过大**: 尝试使用更简单的模型
4. **网络问题**: 检查Draco解码器加载

### 错误提示
- 系统会显示具体的错误信息
- 提供重试选项
- 记录错误日志供调试

## 性能优化

### 建议
- 使用适当分辨率的模型
- 避免过于复杂的几何体
- 合理设置体素化分辨率
- 考虑模型的原始尺寸

### 限制
- 最大处理时间: 30秒
- 最大体素数量: 10,000个
- 支持的最大文件大小: 50MB

## 开发信息

### 文件结构
```
src/
├── glb-processor.js          # GLB处理核心逻辑
├── world_simulator.js        # 主界面集成
└── glb-test.js              # 测试文件
```

### 主要函数
- `processGlbToVoxels()`: 主要的GLB处理函数
- `loadMeshFromGlb()`: GLB文件加载
- `voxelizeMesh()`: 体素化算法

### 依赖
- Three.js: 3D渲染和文件加载
- GLTFLoader: GLB文件解析
- DRACOLoader: 压缩格式支持

## 更新日志

### v1.0.0 (当前版本)
- ✅ 基础GLB导入功能
- ✅ 自动体素化算法
- ✅ 背包集成
- ✅ 错误处理
- ✅ 用户界面集成

### 计划功能
- 🔄 支持更多3D格式
- 🔄 自定义体素化参数
- 🔄 批量导入功能
- 🔄 预览功能

## 技术支持

如果遇到问题，请检查：
1. 文件格式是否正确
2. 网络连接是否正常
3. 浏览器是否支持WebGL
4. 控制台是否有错误信息

---

**注意**: 此功能需要现代浏览器支持，建议使用Chrome、Firefox或Safari的最新版本。 